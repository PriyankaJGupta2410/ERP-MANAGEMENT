<!DOCTYPE html>
<html>
<head>
  <title>Add Supervisor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }

    form {
      max-width: 500px;
      margin: auto;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }

    input, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }

    #response {
      margin-top: 20px;
      font-weight: bold;
      color: green;
      text-align: center;
    }
  </style>
</head>
<body>

  <h2 style="text-align:center;">Add Supervisor</h2>

  <form id="supervisorForm">
    <label>Username:</label>
    <input type="text" name="username" required>

    <label>Email:</label>
    <input type="email" name="email" required>

    <label>Password:</label>
    <input type="password" name="password" required>

    <label>Contact:</label>
    <input type="text" name="contact" pattern="[0-9]{10}" title="Enter a valid 10-digit number" required>

    <input type="hidden" name="role" value="supervisor">

    <label>Salary:</label>
    <input type="number" step="0.01" name="salary" required>

    <label>Join Date:</label>
    <input type="date" name="join_date" required>

    <button type="submit">Add Supervisor</button>
  </form>

  <p id="response"></p>

  <script>
    document.getElementById('supervisorForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const token = localStorage.getItem("token");

      if (!token) {
        document.getElementById("response").innerText = "Authentication token missing.";
        return;
      }

      const form = e.target;
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      // Trim and normalize email
      data.email = data.email.trim().toLowerCase();

      const res = await fetch('http://127.0.0.1:5000/staff/POSTstaff', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-access-token': token
        },
        body: JSON.stringify(data)
      });

      const result = await res.json();
      document.getElementById('response').innerText = result.message || result.error;

      if (res.status === 200 && result.status === "success") {
        setTimeout(() => {
          window.location.href = "/Getstaff";  // Redirect to GETstaff view
        }, 1500);
      }
    });
  </script>

</body>
</html>
